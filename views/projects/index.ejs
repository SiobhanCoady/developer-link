<% let mainColor = 'white'; %>
<% let fontColor = 'black-text'; %>
<% let altFontColor = 'black-text'; %>

<% if (currentUser && currentUser.userType === 'developer') { %>
  <% mainColor = 'deep-purple'; %>
  <% fontColor = 'white-text' %>
  <% altFontColor = 'deep-purple-text' %>
<% } else if (currentUser && currentUser.userType === 'nonprofit') { %>
  <% mainColor = 'cyan'; %>
  <% fontColor = 'white-text' %>
  <% altFontColor = 'cyan-text' %>
<% } %>

<%- include('../partials/header') %>

<div class="container">

  <h1>Search Projects</h1>

  <div class="row">
    <form class="col s12 search-form">
      <div class="row">
        <div class="input-field col s12">
          <input class="search" type="text" name="search" value="<%= searchVal %>">
          <label for="search">Search</label>
        </div>
      </div>
      <div class="row">
        <div class="input-field col s4">
          <select name="charity" class="charity-form">
            <option value="" disabled selected>Charity Types</option>
            <% for (let char of chars) { %>
              <option
                <% if (selectedChar.includes(char.name)) { %>
                  selected
                <% } %>
                value="<%= char.name %>"><%= char.name %></option>
            <% } %>
          </select>
        </div>

        <div class="input-field col s4">
          <select name="technology" class="technology-form" multiple>
            <option value="" disabled selected>Technologies</option>
            <% for (let tech of techs) { %>
              <option
                <% if (selectedTechs.includes(tech.name)) { %>
                  selected
                <% } %>
                value="<%= tech.name %>"><%= tech.name %></option>
            <% } %>
          </select>
        </div>

        <div class="input-field col s4">
          <select name="language" class="language-form" multiple>
            <option value="" disabled selected>Languages</option>
            <% for (let lang of langs) { %>
              <option
                <% if (selectedLangs.includes(lang.name)) { %>
                  selected
                <% } %>
                value="<%= lang.name %>"><%= lang.name %></option>
            <% } %>
          </select>
        </div>

      </div>
      <button class="btn waves-effect waves-light"
        type="submit" name="action">Submit
      </button>
      <button class="btn waves-effect waves-light reset-form"
        type="reset" name="action">Reset
      </button>
    </form>
  </div>

  <div id="map"></div>

  <h1>Browse Projects</h1>

  <ul class="collapsible popout projects-list" data-collapsible="expandable">
    <% for (let project of projects) { %>
      <li>
        <div class="collapsible-header">
          <i class="material-icons">web</i>
          <%= project.title %>
        </div>
        <div class="collapsible-body">
          <span><%= project.description %></span>
          <p>Deadline: <span data-moment-format="LL"><%= project.deadline %></span></p>
          <p>GitHub: <%= project.github %></p>

          <p>Charity Type:
            <% if (project.owner) { %>
              <div class="chip"><%= project.owner.charityType %></div>
            <% } %>
          </p>

          <p>Technologies:
            <% for (let tag of project.Tags) { %>
              <% if (tag.tagType === 'technology') { %>
                <div class="chip"><%= tag.name %></div>
              <% } %>
            <% } %>
          </p>

          <p>Languages:
            <% for (let tag of project.Tags) { %>
              <% if (tag.tagType === 'language') { %>
                <div class="chip"><%= tag.name %></div>
              <% } %>
            <% } %>
          </p>

          <p>Non-profit:
            <% if (project.owner) { %>
              <%= project.owner.orgName %>
            <% } %>
          </p>

          <div class="right-align">
            <a class="waves-effect waves-teal btn-flat" href="/users/<%= project.ownerId %>">
              Profile
            </a>
          </div>

        </div>
      </li>
    <% } %>

</div>

<footer class="page-footer <%= mainColor %>">
  <div class="container my-footer">
  </div>
</footer>

<script>
  function initMap() {
    var center = {lat: 20, lng: 0};
    var map = new google.maps.Map(document.getElementById('map'), {
      zoom: 2,
      center: center
    });
    for (let project of <%- JSON.stringify(projectCoords) %>) {
      var marker = new google.maps.Marker({
        position: {lat: project[1], lng: project[2]},
        map: map,
        title: project[0],
        zIndex: project[3]
      });
    }
  }
</script>

<script async defer
  src="https://maps.googleapis.com/maps/api/js?key=<%= process.env.GOOGLE_MAPS_API_TOKEN %>&callback=initMap">
</script>

<%- include('../partials/footer') %>
